name: Workflows generated by the MVS plan
on:
  workflow_dispatch:
    inputs:
      client_payload:
        description: The Client payload
        required: true

env:
  payload: ${{fromJSON(github.event.inputs.client_payload).payload}}
  payload2: "super testt!!!!!!!!!!!!!!!!!!!!!"

jobs:
  secret-detection2:  
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'secret-detection2'
    runs-on: ubuntu-20.04
    steps:
      - name: detect-secrets
        uses: jitsecurity-controls/jit-github-action@v2.0
        with:
          docker_user: jit-bot
          docker_password: ${{fromJSON(github.event.inputs.client_payload).payload.container_registry_token}}
          security_control: ghcr.io/jitsecurity-controls/control-detect-secrets-slim:main
          security_control_args: ${{env.payload}}.container_registry_token ${{env.payload2}}
          security_control_output_file: ${{env.payload}}.container_registry_token
          dispatch_type: workflow

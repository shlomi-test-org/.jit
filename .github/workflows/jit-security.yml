name: Workflows generated by the MVS plan
run-name: ${{fromJSON(github.event.inputs.client_payload).payload.job_title}}
on:
  workflow_dispatch:
    inputs:
       client_payload:
          description: The Client payload
          required: true

permissions:
  contents: read
  id-token: write

jobs:
  api-security-detection:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'api-security-detection' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-api-security'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: 
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/zap:latest
        
  docker-scan:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'docker-scan' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-docker-scan'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: trivy
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-trivy-alpine:main
        
  enrich:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'enrich' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-enrichment-code'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: enrichment
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-enrichment-slim:main
        
  iac-misconfig-detection-cloudformation:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'iac-misconfig-detection-cloudformation' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-iac-misconfiguration-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: kics
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-kics-alpine:main
        security_control_output_file: /code/jit-report/results.json
        
  iac-misconfig-detection-kubernetes:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'iac-misconfig-detection-kubernetes' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-kubernetes-iac-misconfiguration-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 105
    steps:
    - name: kubescape
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-kubescape-slim:main
        security_control_output_file: /code/results.json
        
  iac-misconfig-detection-pulumi:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'iac-misconfig-detection-pulumi' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-iac-misconfiguration-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: kics
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-kics-alpine:main
        security_control_output_file: /code/jit-report/results.json
        
  iac-misconfig-detection-terraform:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'iac-misconfig-detection-terraform' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-iac-misconfiguration-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: kics
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-kics-alpine:main
        security_control_output_file: /code/jit-report/results.json
        
  remediation-pr:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'remediation-pr' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-remediation-pr'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: remediation-pr
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/open-remediation-pr-alpine:main
        security_control_output_file: /opt/code/jit-report/results.json
        
  secret-detection:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'secret-detection' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-secret-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: gitleaks
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-gitleaks-alpine:main
        security_control_output_file: /tmp/report.json
        
  software-bill-of-materials:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-bill-of-materials' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sbom'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: syft-alpine:not-hardened
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-syft-alpine:not-hardened-main
        fail_if_cannot_checkout: false
        
  software-component-analysis-go:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-go' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: nancy
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-nancy-alpine:main
        
  software-component-analysis-java:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-java' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: osv-scanner
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-osv-scanner-alpine:main
        
  software-component-analysis-js:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-js' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: npm-audit
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-npm-audit-slim:main
        security_control_output_file: /code/jit-report/enriched-audit-results.json
        
  software-component-analysis-php:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-php' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: osv-scanner
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-osv-scanner-alpine:main
        
  software-component-analysis-python:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-python' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: osv-scanner
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-osv-scanner-alpine:main
        
  software-component-analysis-trivy-csharp:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'software-component-analysis-trivy-csharp' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sca'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: trivy-dotnet
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-trivy-dotnet-slim:main
        
  static-code-analysis-c-cpp:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-c-cpp' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-csharp:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-csharp' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-go:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-go' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: gosec
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-gosec-alpine:main
        
  static-code-analysis-java:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-java' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-js:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-js' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-kotlin:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-kotlin' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-php:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-php' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-python-semgrep:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-python-semgrep' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-ruby:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-ruby' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-rust:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-rust' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-scala:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-scala' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  static-code-analysis-swift:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-swift' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-sast'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: semgrep
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/control-semgrep-alpine:main
        
  web-security-detection:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'web-security-detection' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-web-app-scanner'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: hardened-avichay
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/zap:not-hardened-avichay-asvs
        
  web-security-detection-secure-software-development-lifecycle:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'web-security-detection-secure-software-development-lifecycle' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-asvs-secure-software-development-lifecycle'
    runs-on: ubuntu-20.04
    timeout-minutes: 105
    steps:
    - name: hardened-avichay
      uses: jitsecurity-controls/jit-github-action@v4.2.1
      with:
        security_control: registry.jit.io/zap:not-hardened-avichay-asvs
        
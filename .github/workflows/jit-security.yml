name: Workflows generated by the MVS plan
run-name: ${{fromJSON(github.event.inputs.client_payload).payload.job_title}}
on:
  workflow_dispatch:
    inputs:
       client_payload:
          description: The Client payload
          required: true

permissions:
  contents: read
  id-token: write














  

jobs:
  api-security-detection:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'api-security-detection' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-api-security'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: hardened-avichay
      uses: jitsecurity-controls/jit-github-action@v4.0.6
      with:
        security_control: registry.jit.io/zap:not-hardened-avichay-asvs
        
  docker-scan:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'docker-scan' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-docker-scan'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: trivy
      uses: jitsecurity-controls/jit-github-action@v4.0.6
      with:
        security_control: registry.jit.io/control-trivy-alpine:main
        
  enrich:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'enrich' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-enrichment-code'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: enrichment
      uses: jitsecurity-controls/jit-github-action@v4.0.6
      with:
        security_control: registry.jit.io/control-enrichment-slim:main
        
  iac-misconfig-detection-kubernetes:
    if: fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'iac-misconfig-detection-kubernetes' && fromJSON(github.event.inputs.client_payload).payload.workflow_slug == 'workflow-kubernetes-iac-misconfiguration-detection'
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    steps:
    - name: kubescape
      uses: jitsecurity-controls/jit-github-action@v4.0.6
      with:
        security_control: registry.jit.io/control-kubescape-slim:main
        security_control_output_file: /code/results.json
